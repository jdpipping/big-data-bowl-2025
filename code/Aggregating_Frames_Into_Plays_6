library(tidyverse)

# If needed, can read in final_dropbacks_merged file that was defined earlier in "incorporating model code" file
final_dropbacks_merged <- read_csv("final_dropbacks_merged.csv")

# Start with a version where each row represents a player on a full play (i.e. not a frame) 
# NOTE: if we want "last element," just replace the [1] with [length(ball_x)], or whatever the variable was
colnames(final_dropbacks_merged)
# Realistically, this one won't be as useful as the "full play" version, but good to have as a formality
Stats_ByPlayerAndPlay_Final <- final_dropbacks_merged %>% filter(club != "football") %>%
  group_by(gameId, playId, nflId, displayName) %>%
  summarize(Frames = n(), down = max(down), distance = max(yardsToGo), Team = max(club),
            PlayerSideOfBall = PlayerSideOfBall[1], Player_Role = max(Player_Role), PosTeam = max(posteam), 
            DefTeam = max(defteam), posteam_type = max(posteam_type), # HomeTeam = max(homeTeamAbbr), AwayTeam = max(visitorTeamAbbr),
            yardline_100 = max(yardline_100), yardsToGo = max(yardsToGo), # Dropback = max(isDropback),
            # BallCarrierID = max(ballCarrierId), BallCarrierName = max(ballCarrierDisplayName),
            IsBallCarrier = max(IsBallCarrier), Description = max(playDescription), 
            PenaltyYards = max(penaltyYards), 
            NetYardage = max(yardsGained), PrePenaltyYardage = max(prePenaltyYardsGained), 
            # YdsBeforeContact = max(YdsBeforeContact), YdsAfterContact = max(YdsAfterContact),
            # TeamDefendersInBox = max(defendersInTheBox),
            xpass = max(xpass), # pass_oe = max(pass_oe),
            EP = max(expectedPoints), EPA = max(expectedPointsAdded), EPSuccess = max(success),
            posteam_type = max(posteam_type), yardline_100 = max(yardline_100),
            Shotgun = max(shotgun), aligned_left_receivers = max(aligned_left_receivers), 
            aligned_right_receivers = max(aligned_right_receivers), aligned_total_receivers = max(aligned_total_receivers),
            sp = max(sp), goal_to_go = max(goal_to_go),
            DropbackOutcome = max(passResult),
            # TargetReceiver_X_AtArrival = max(targetX), TargetReceiver_Y_AtArrival = max(targetY),
            RPO = max(pff_runPassOption), Coverage_Scheme = max(pff_passCoverage),
            ManVsZone = max(pff_manZone), PostSnap_MOF = max(PostSnap_MOF), PostSnap_MOF_Num = max(PostSnap_MOF_Num),
            PlayClock_AtSnap = max(playClockAtSnap), no_huddle = max(no_huddle),
            pass_horiz_location = max(pass_location), air_yards = max(air_yards), team_yards_after_catch = max(yards_after_catch), 
            Team_PassTD = max(pass_touchdown), TeamTouchdown = max(touchdown), 
            TeamRushTD = max(rush_touchdown), TeamReturnTD = max(return_touchdown), 
            td_team = max(td_team), WP = max(wp), WPA = max(wpa), DefWPA = max(DefWPA), WPSuccess = max(WPSuccess),
            OffTeam_Fumble = max(fumble), OffTeam_LostFumble = max(fumble_lost), 
            penalty_team = max(penalty_team), penalty_type = max(penalty_type), 
            return_team = max(return_team), return_yards = max(return_yards),
            Completion_Prob = max(cp), CPOE = max(cpoe),
            Team_Interception = max(interception), Off_AllowedSafety = max(safety), Team_Completion = max(complete_pass),
            Team_PassAttempt = max(pass_attempt), TeamTFL = max(tackled_for_loss), 
            # Temperature = max(Temperature), roof = max(roof), surface = max(surface), 
            first_down = max(first_down), out_of_bounds = max(out_of_bounds), PlayDirection = max(playDirection), 
            Indiv_RushAtt = max(hadRushAttempt), Indiv_RushYds = max(rushingYards),
            Indiv_Dropback = max(hadDropback), Indiv_PassYds = max(passingYards),
            Indiv_SackYdsLost = max(sackYardsAsOffense), Indiv_Reception = max(hadPassReception),
            Indiv_RecYds = max(receivingYards), Indiv_Targets = max(wasTargetedReceiver),
            Indiv_YardsAfterCatch = max(yardageGainedAfterTheCatch), Indiv_Fumbles = max(fumbles),
            Indiv_FumbleLost = max(fumbleLost), Indiv_AssistTKL = max(assistedTackle),
            Indiv_ForcedFumble = max(forcedFumbleAsDefense), Indiv_PassDefensed = max(passDefensed),
            Indiv_QBHit = max(quarterbackHit), Indiv_SoloTKL = max(soloTackle),
            Indiv_HalfSackYds_Defense = max(halfSackYardsAsDefense), Indiv_FullSackYds_Defense = max(sackYardsAsDefense),
            # Indiv_TFLYardage = max(tackleForALossYardage) ... keep in mind any TFL on a dropback is a sack
            Indiv_DefInterception = max(hadInterception), Indiv_DefINT_Yards <- max(interceptionYards),
            Indiv_FR = max(fumbleRecoveries), Indiv_FumbleRecYds = max(fumbleRecoveryYards),
            Indiv_PassRusher = max(wasInitialPassRusher), Indiv_Pressure = max(causedPressure),
            Indiv_MotionDuringSnap = max(inMotionAtBallSnap), Indiv_MotionSinceLineSet = max(motionSinceLineset),
            Indiv_ShiftSinceLineSet = max(shiftSinceLineset), Indiv_RanRoute = max(wasRunningRoute),
            Indiv_RouteType = max(routeRan), Indiv_CoverageAssignment = max(pff_defensiveCoverageAssignment),
            Indiv_PrimDefCoverageMatchup_ID = max(pff_primaryDefensiveCoverageMatchupNflId),
            Indiv_SecondDefCoverageMatchup_ID = max(pff_secondaryDefensiveCoverageMatchupNflId),
            Ball_X_Snap = max(Ball_X_Snap), Ball_Y_Snap = max(Ball_Y_Snap),
            Initial_X = x[1], Initial_Y = y[1], X_AtSnap = max(PreSnap_x), Y_AtSnap = max(PreSnap_y),
            MaxSpeed = max(s), AvgSpeed = mean(s),
            MaxAcceleration = max(a), AvgAcceleration = mean(a),
            TotDistance = sum(dis), InitialOrientation = o[1], InitialDirection = dir[1],
            Initial_X_DistFromBall = X_DistFromBall[1], Initial_X_AbsDistFromBall = X_AbsDistFromBall[1],
            Initial_Y_DistFromBall = Y_DistFromBall[1], Initial_Y_AbsDistFromBall = Y_AbsDistFromBall[1],
            Initial_Tot_DistFromBall = TotDistFromBall[1],
            Initial_Y_DistFromMOF = Y_distFromMOF[1], Initial_Y_AbsDistFromMOF = abs(Y_distFromMOF[1]),
            Max_X_DistFromBall = max(X_DistFromBall), Max_X_AbsDistFromBall = max(X_AbsDistFromBall),
            Max_Y_DistFromBall = max(Y_DistFromBall), Max_Y_AbsDistFromBall = max(Y_AbsDistFromBall), 
            Max_Tot_DistFromBall = max(TotDistFromBall),
            # height = max(height_inches), weight = max(weight), 
            PosGroup = max(PosGroup), official_position = max(position),
            is_pre_snap_safety = max(is_pre_snap_safety), is_post_snap_safety = max(is_post_snap_safety),
            num_safeties_pre_snap = max(num_safeties_pre_snap), num_safeties_post_snap = max(num_safeties_post_snap),
            pre_snap_safety_1_ID = max(pre_snap_safety_1), pre_snap_safety_1_name = max(pre_snap_safety_1_name),
            pre_snap_safety_2_ID = max(pre_snap_safety_2), pre_snap_safety_2_name = max(pre_snap_safety_2_name),
            post_snap_safety_1_ID = max(post_snap_safety_1), post_snap_safety_1_name = max(post_snap_safety_1_name),
            post_snap_safety_2_ID = max(post_snap_safety_2), post_snap_safety_2_name = max(post_snap_safety_2_name),
            pre_snap_safety_1_X_AtSnap = max(pre_snap_safety_1_X_AtSnap), pre_snap_safety_1_Y_AtSnap = max(pre_snap_safety_1_Y_AtSnap), 
            pre_snap_safety_2_X_AtSnap = max(pre_snap_safety_2_X_AtSnap), pre_snap_safety_2_Y_AtSnap = max(pre_snap_safety_2_Y_AtSnap), 
            X_Diff_BetweenSafeties_AtSnap = max(X_Diff_BetweenSafeties_AtSnap),
            Max_PreSnap_x_vel_component = max(x_vel_component), Max_PreSnap_y_vel_component = max(y_vel_component), 
            Max_PreSnap_x_acc_component = max(x_acc_component), Max_PreSnap_y_acc_component = max(y_acc_component),
            Mean_x_vel_component = mean(x_vel_component), Mean_y_vel_component = mean(y_vel_component), 
            Mean_x_acc_component = mean(x_acc_component), Mean_y_acc_component = mean(y_acc_component),
            MOFO_probability_FDA = max(MOFO_probability_FDA), min_SafetyAbsHorizDistToMOF_PreSnap = max(min_SafetyAbsHorizDistToMOF_PreSnap),
            Safety1_Initial_X = Safety1_Initial_X[1], Safety1_Initial_Y = Safety1_Initial_Y[1], 
            Safety1_Max_PreSnap_PreSnapSpeed = max(Safety1_Max_PreSnapSpeed), Safety1_Avg_PreSnapSpeed = mean(Safety1_Avg_PreSnapSpeed),
            Safety1_Max_PreSnapAcceleration = max(Safety1_Max_PreSnapAcceleration), 
            Safety1_Avg_PreSnapAcceleration = mean(Safety1_Avg_PreSnapAcceleration),
            Safety1_Max_PreSnap_x_vel_component = max(Safety1_Max_PreSnap_x_vel_component), 
            Safety1_Max_PreSnap_y_vel_component = max(Safety1_Max_PreSnap_y_vel_component), 
            Safety1_Max_PreSnap_x_acc_component = max(Safety1_Max_PreSnap_x_acc_component), 
            Safety1_Max_PreSnap_y_acc_component = max(Safety1_Max_PreSnap_y_acc_component),
            Safety1_Mean_PreSnap_x_vel_component = mean(Safety1_Mean_PreSnap_x_vel_component), 
            Safety1_Mean_PreSnap_y_vel_component = mean(Safety1_Mean_PreSnap_y_vel_component), 
            Safety1_Mean_PreSnap_x_acc_component = mean(Safety1_Mean_PreSnap_x_acc_component), 
            Safety1_Mean_PreSnap_y_acc_component = mean(Safety1_Mean_PreSnap_y_acc_component), 
            Safety1_Tot_PreSnapDistance = sum(Safety1_Tot_PreSnapDistance), Safety1_InitialOrientation = Safety1_InitialOrientation[1],
            Safety1_InitialDirection = Safety1_InitialDirection[1], Safety1_Initial_X_DistFromBall = Safety1_Initial_X_DistFromBall[1],
            Safety1_Initial_Y_DistFromBall = Safety1_Initial_Y_DistFromBall[1], Safety1_Initial_Tot_DistFromBall = Safety1_Initial_Tot_DistFromBall[1],
            Safety1_Initial_Y_DistFromMOF = Safety1_Initial_Y_DistFromMOF[1], Safety1_Initial_Y_AbsDistFromMOF = Safety1_Initial_Y_AbsDistFromMOF[1],
            Safety1_Max_PreSnap_X_DistFromBall = max(Safety1_Max_PreSnap_X_DistFromBall),
            Safety1_Max_PreSnap_Y_AbsDistFromBall = max(Safety1_Max_PreSnap_Y_AbsDistFromBall), 
            Safety1_Max_PreSnap_Tot_DistFromBall = max(Safety1_Max_PreSnap_Tot_DistFromBall),
            Safety1_X_DistFromBall_AtSnap = max(Safety1_X_DistFromBall_AtSnap),
            Safety1_Y_DistFromBall_AtSnap = max(Safety1_Y_DistFromBall_AtSnap),
            Safety1_Y_AbsDistFromBall_AtSnap = max(Safety1_Y_AbsDistFromBall_AtSnap),
            Safety1_Y_DistFromMOF_AtSnap = max(Safety1_Y_DistFromMOF_AtSnap),
            Safety1_Y_AbsDistFromMOF_AtSnap = max(Safety1_Y_AbsDistFromMOF_AtSnap),
            Safety1_Tot_DistFromBall_AtSnap = max(Safety1_Tot_DistFromBall_AtSnap),
            Safety1_Speed_AtSnap = max(Safety1_Speed_AtSnap), Safety1_Acceleration_AtSnap = max(Safety1_Acceleration_AtSnap),
            Safety1_x_vel_component_AtSnap = max(Safety1_x_vel_component_AtSnap),
            Safety1_y_vel_component_AtSnap = max(Safety1_y_vel_component_AtSnap),
            Safety1_x_acc_component_AtSnap = max(Safety1_x_acc_component_AtSnap),
            Safety1_y_acc_component_AtSnap = max(Safety1_y_acc_component_AtSnap),
            Safety1_Orientation_AtSnap = max(Safety1_Orientation_AtSnap), Safety1_Direction_AtSnap = max(Safety1_Direction_AtSnap),
            Safety1_X_3SecBeforeSnap = max(Safety1_X_3SecBeforeSnap), Safety1_Y_3SecBeforeSnap = max(Safety1_Y_3SecBeforeSnap), 
            Safety1_VertCreptDistance = max(Safety1_VertCreptDistance), Safety1_TotalCreptDistance_TowardBall = max(Safety1_TotalCreptDistance_TowardBall),
            Safety1_PosGroup = max(Safety1_PosGroup), Safety1_position = max(Safety1_position),
            x_spline_basis1_p1 = max(x_spline_basis1_p1), x_spline_basis2_p1 = max(x_spline_basis2_p1), 
            x_spline_basis3_p1 = max(x_spline_basis3_p1), x_spline_basis4_p1 = max(x_spline_basis4_p1),
            x_spline_basis5_p1 = max(x_spline_basis5_p1), x_spline_basis6_p1 = max(x_spline_basis6_p1),                       
            x_spline_basis7_p1 = max(x_spline_basis7_p1), x_spline_basis8_p1 = max(x_spline_basis8_p1),                     
            x_spline_basis9_p1 = max(x_spline_basis9_p1), x_spline_basis10_p1 = max(x_spline_basis10_p1),                   
            y_spline_basis1_p1 = max(y_spline_basis1_p1), y_spline_basis2_p1 = max(y_spline_basis2_p1),          
            y_spline_basis3_p1 = max(y_spline_basis3_p1), y_spline_basis4_p1 = max(y_spline_basis4_p1),                  
            y_spline_basis5_p1 = max(y_spline_basis5_p1), y_spline_basis6_p1 = max(y_spline_basis6_p1),                 
            y_spline_basis7_p1 = max(y_spline_basis7_p1), y_spline_basis8_p1 = max(y_spline_basis8_p1),                  
            y_spline_basis9_p1 = max(y_spline_basis9_p1), y_spline_basis10_p1 = max(y_spline_basis10_p1),                  
            Safety2_Initial_X = Safety2_Initial_X[1], Safety2_Initial_Y = Safety2_Initial_Y[1], 
            Safety2_Max_PreSnap_PreSnapSpeed = max(Safety2_Max_PreSnapSpeed), Safety2_Avg_PreSnapSpeed = mean(Safety2_Avg_PreSnapSpeed),
            Safety2_Max_PreSnapAcceleration = max(Safety2_Max_PreSnapAcceleration), 
            Safety2_Avg_PreSnapAcceleration = mean(Safety2_Avg_PreSnapAcceleration),
            Safety2_Max_PreSnap_x_vel_component = max(Safety2_Max_PreSnap_x_vel_component), 
            Safety2_Max_PreSnap_y_vel_component = max(Safety2_Max_PreSnap_y_vel_component), 
            Safety2_Max_PreSnap_x_acc_component = max(Safety2_Max_PreSnap_x_acc_component), 
            Safety2_Max_PreSnap_y_acc_component = max(Safety2_Max_PreSnap_y_acc_component),
            Safety2_Mean_PreSnap_x_vel_component = mean(Safety2_Mean_PreSnap_x_vel_component), 
            Safety2_Mean_PreSnap_y_vel_component = mean(Safety2_Mean_PreSnap_y_vel_component), 
            Safety2_Mean_PreSnap_x_acc_component = mean(Safety2_Mean_PreSnap_x_acc_component), 
            Safety2_Mean_PreSnap_y_acc_component = mean(Safety2_Mean_PreSnap_y_acc_component), 
            Safety2_Tot_PreSnapDistance = sum(Safety2_Tot_PreSnapDistance), Safety2_InitialOrientation = Safety2_InitialOrientation[1],
            Safety2_InitialDirection = Safety2_InitialDirection[1], Safety2_Initial_X_DistFromBall = Safety2_Initial_X_DistFromBall[1],
            Safety2_Initial_Y_DistFromBall = Safety2_Initial_Y_DistFromBall[1], Safety2_Initial_Tot_DistFromBall = Safety2_Initial_Tot_DistFromBall[1],
            Safety2_Initial_Y_DistFromMOF = Safety2_Initial_Y_DistFromMOF[1], Safety2_Initial_Y_AbsDistFromMOF = Safety2_Initial_Y_AbsDistFromMOF[1],
            Safety2_Max_PreSnap_X_DistFromBall = max(Safety2_Max_PreSnap_X_DistFromBall),
            Safety2_Max_PreSnap_Y_AbsDistFromBall = max(Safety2_Max_PreSnap_Y_AbsDistFromBall), 
            Safety2_Max_PreSnap_Tot_DistFromBall = max(Safety2_Max_PreSnap_Tot_DistFromBall),
            Safety2_X_DistFromBall_AtSnap = max(Safety2_X_DistFromBall_AtSnap),
            Safety2_Y_DistFromBall_AtSnap = max(Safety2_Y_DistFromBall_AtSnap),
            Safety2_Y_AbsDistFromBall_AtSnap = max(Safety2_Y_AbsDistFromBall_AtSnap),
            Safety2_Y_DistFromMOF_AtSnap = max(Safety2_Y_DistFromMOF_AtSnap),
            Safety2_Y_AbsDistFromMOF_AtSnap = max(Safety2_Y_AbsDistFromMOF_AtSnap),
            Safety2_Tot_DistFromBall_AtSnap = max(Safety2_Tot_DistFromBall_AtSnap),
            Safety2_Speed_AtSnap = max(Safety2_Speed_AtSnap), Safety2_Acceleration_AtSnap = max(Safety2_Acceleration_AtSnap),
            Safety2_x_vel_component_AtSnap = max(Safety2_x_vel_component_AtSnap),
            Safety2_y_vel_component_AtSnap = max(Safety2_y_vel_component_AtSnap),
            Safety2_x_acc_component_AtSnap = max(Safety2_x_acc_component_AtSnap),
            Safety2_y_acc_component_AtSnap = max(Safety2_y_acc_component_AtSnap),
            Safety2_Orientation_AtSnap = max(Safety2_Orientation_AtSnap), Safety2_Direction_AtSnap = max(Safety2_Direction_AtSnap),
            Safety2_X_3SecBeforeSnap = max(Safety2_X_3SecBeforeSnap), Safety2_Y_3SecBeforeSnap = max(Safety2_Y_3SecBeforeSnap), 
            Safety2_VertCreptDistance = max(Safety2_VertCreptDistance), Safety2_TotalCreptDistance_TowardBall = max(Safety2_TotalCreptDistance_TowardBall),
            Safety2_PosGroup = max(Safety2_PosGroup), Safety2_position = max(Safety2_position),
            x_spline_basis1_p2 = max(x_spline_basis1_p2), x_spline_basis2_p2 = max(x_spline_basis2_p2), 
            x_spline_basis3_p2 = max(x_spline_basis3_p2), x_spline_basis4_p2 = max(x_spline_basis4_p2),
            x_spline_basis5_p2 = max(x_spline_basis5_p2), x_spline_basis6_p2 = max(x_spline_basis6_p2),                       
            x_spline_basis7_p2 = max(x_spline_basis7_p2), x_spline_basis8_p2 = max(x_spline_basis8_p2),                     
            x_spline_basis9_p2 = max(x_spline_basis9_p2), x_spline_basis10_p2 = max(x_spline_basis10_p2),                   
            y_spline_basis1_p2 = max(y_spline_basis1_p2), y_spline_basis2_p2 = max(y_spline_basis2_p2),          
            y_spline_basis3_p2 = max(y_spline_basis3_p2), y_spline_basis4_p2 = max(y_spline_basis4_p2),                  
            y_spline_basis5_p2 = max(y_spline_basis5_p2), y_spline_basis6_p2 = max(y_spline_basis6_p2),                 
            y_spline_basis7_p2 = max(y_spline_basis7_p2), y_spline_basis8_p2 = max(y_spline_basis8_p2),                  
            y_spline_basis9_p2 = max(y_spline_basis9_p2), y_spline_basis10_p2 = max(y_spline_basis10_p2))

Stats_ByPlayerAndPlay_Final <- Stats_ByPlayerAndPlay_Final %>% filter(club != "football") %>%
  mutate(Indiv_OffTD = ifelse(PlayerSideOfBall %in% "offense" & !is.na(IsBallCarrier) & IsBallCarrier == 1 & !is.na(td_team) & td_team == PosTeam, 1,
               ifelse(PlayerSideOfBall %in% "offense" & (is.na(IsBallCarrier) | IsBallCarrier == 0 | is.na(td_team) | td_team != PosTeam), 0, NA)))
Stats_ByPlayerAndPlay_Final <- Stats_ByPlayerAndPlay_Final %>%
  mutate(Indiv_ShiftOrMotion = (Indiv_MotionDuringSnap + Indiv_MotionSinceLineSet + Indiv_ShiftSinceLineSet), na.rm = TRUE)

# Now create a version where each row represents an entire play (not a player or a frame)
Stats_ByFullPlay_Final <- final_dropbacks_merged %>%
  group_by(gameId, playId) %>%
  summarize(Frames = n(), down = max(down), distance = max(yardsToGo), PosTeam = max(posteam), 
            DefTeam = max(defteam), posteam_type = max(posteam_type), # HomeTeam = max(homeTeamAbbr), AwayTeam = max(visitorTeamAbbr),
            yardline_100 = max(yardline_100), yardsToGo = max(yardsToGo), # Dropback = max(isDropback),
            # BallCarrierID = max(ballCarrierId), BallCarrierName = max(ballCarrierDisplayName),
            Description = max(playDescription), PenaltyYards = max(penaltyYards), 
            NetYardage = max(yardsGained), PrePenaltyYardage = max(prePenaltyYardsGained), 
            # YdsBeforeContact = max(YdsBeforeContact), YdsAfterContact = max(YdsAfterContact),
            # TeamDefendersInBox = max(defendersInTheBox),
            xpass = max(xpass), # pass_oe = max(pass_oe),
            EP = max(expectedPoints), EPA = max(expectedPointsAdded), EPSuccess = max(success),
            posteam_type = max(posteam_type), yardline_100 = max(yardline_100),
            Shotgun = max(shotgun), aligned_left_receivers = max(aligned_left_receivers), 
            aligned_right_receivers = max(aligned_right_receivers), aligned_total_receivers = max(aligned_total_receivers),
            sp = max(sp), goal_to_go = max(goal_to_go),
            DropbackOutcome = max(passResult),
            # TargetReceiver_X_AtArrival = max(targetX), TargetReceiver_Y_AtArrival = max(targetY),
            RPO = max(pff_runPassOption), Coverage_Scheme = max(pff_passCoverage),
            ManVsZone = max(pff_manZone), PostSnap_MOF = max(PostSnap_MOF), PostSnap_MOF_Num = max(PostSnap_MOF_Num),
            PlayClock_AtSnap = max(playClockAtSnap), no_huddle = max(no_huddle),
            pass_horiz_location = max(pass_location), air_yards = max(air_yards), team_yards_after_catch = max(yards_after_catch), 
            Team_PassTD = max(pass_touchdown), TeamTouchdown = max(touchdown), 
            TeamRushTD = max(rush_touchdown), TeamReturnTD = max(return_touchdown), 
            td_team = max(td_team), WP = max(wp), WPA = max(wpa), DefWPA = max(DefWPA), WPSuccess = max(WPSuccess),
            OffTeam_Fumble = max(fumble), OffTeam_LostFumble = max(fumble_lost), 
            penalty_team = max(penalty_team), penalty_type = max(penalty_type), 
            return_team = max(return_team), return_yards = max(return_yards),
            Completion_Prob = max(cp), CPOE = max(cpoe),
            Team_Interception = max(interception), Off_AllowedSafety = max(safety), Team_Completion = max(complete_pass),
            Team_PassAttempt = max(pass_attempt), TeamTFL = max(tackled_for_loss), 
            # Temperature = max(Temperature), roof = max(roof), surface = max(surface), 
            first_down = max(first_down), out_of_bounds = max(out_of_bounds), PlayDirection = max(playDirection), 
            num_safeties_pre_snap = max(num_safeties_pre_snap), num_safeties_post_snap = max(num_safeties_post_snap),
            pre_snap_safety_1_ID = max(pre_snap_safety_1), pre_snap_safety_1_name = max(pre_snap_safety_1_name),
            pre_snap_safety_2_ID = max(pre_snap_safety_2), pre_snap_safety_2_name = max(pre_snap_safety_2_name),
            post_snap_safety_1_ID = max(post_snap_safety_1), post_snap_safety_1_name = max(post_snap_safety_1_name),
            post_snap_safety_2_ID = max(post_snap_safety_2), post_snap_safety_2_name = max(post_snap_safety_2_name),
            pre_snap_safety_1_X_AtSnap = max(pre_snap_safety_1_X_AtSnap), pre_snap_safety_1_Y_AtSnap = max(pre_snap_safety_1_Y_AtSnap), 
            pre_snap_safety_2_X_AtSnap = max(pre_snap_safety_2_X_AtSnap), pre_snap_safety_2_Y_AtSnap = max(pre_snap_safety_2_Y_AtSnap), 
            X_Diff_BetweenSafeties_AtSnap = max(X_Diff_BetweenSafeties_AtSnap),
            MOFO_probability_FDA = max(MOFO_probability_FDA), min_SafetyAbsHorizDistToMOF_PreSnap = max(min_SafetyAbsHorizDistToMOF_PreSnap),
            Safety1_Initial_X = Safety1_Initial_X[1], Safety1_Initial_Y = Safety1_Initial_Y[1], 
            Safety1_Max_PreSnap_PreSnapSpeed = max(Safety1_Max_PreSnapSpeed), Safety1_Avg_PreSnapSpeed = mean(Safety1_Avg_PreSnapSpeed),
            Safety1_Max_PreSnapAcceleration = max(Safety1_Max_PreSnapAcceleration), 
            Safety1_Avg_PreSnapAcceleration = mean(Safety1_Avg_PreSnapAcceleration),
            Safety1_Max_PreSnap_x_vel_component = max(Safety1_Max_PreSnap_x_vel_component), 
            Safety1_Max_PreSnap_y_vel_component = max(Safety1_Max_PreSnap_y_vel_component), 
            Safety1_Max_PreSnap_x_acc_component = max(Safety1_Max_PreSnap_x_acc_component), 
            Safety1_Max_PreSnap_y_acc_component = max(Safety1_Max_PreSnap_y_acc_component),
            Safety1_Mean_PreSnap_x_vel_component = mean(Safety1_Mean_PreSnap_x_vel_component), 
            Safety1_Mean_PreSnap_y_vel_component = mean(Safety1_Mean_PreSnap_y_vel_component), 
            Safety1_Mean_PreSnap_x_acc_component = mean(Safety1_Mean_PreSnap_x_acc_component), 
            Safety1_Mean_PreSnap_y_acc_component = mean(Safety1_Mean_PreSnap_y_acc_component), 
            Safety1_Tot_PreSnapDistance = sum(Safety1_Tot_PreSnapDistance), Safety1_InitialOrientation = Safety1_InitialOrientation[1],
            Safety1_InitialDirection = Safety1_InitialDirection[1], Safety1_Initial_X_DistFromBall = Safety1_Initial_X_DistFromBall[1],
            Safety1_Initial_Y_DistFromBall = Safety1_Initial_Y_DistFromBall[1], Safety1_Initial_Tot_DistFromBall = Safety1_Initial_Tot_DistFromBall[1],
            Safety1_Initial_Y_DistFromMOF = Safety1_Initial_Y_DistFromMOF[1], Safety1_Initial_Y_AbsDistFromMOF = Safety1_Initial_Y_AbsDistFromMOF[1],
            Safety1_Max_PreSnap_X_DistFromBall = max(Safety1_Max_PreSnap_X_DistFromBall),
            Safety1_Max_PreSnap_Y_AbsDistFromBall = max(Safety1_Max_PreSnap_Y_AbsDistFromBall), 
            Safety1_Max_PreSnap_Tot_DistFromBall = max(Safety1_Max_PreSnap_Tot_DistFromBall),
            Safety1_X_DistFromBall_AtSnap = max(Safety1_X_DistFromBall_AtSnap),
            Safety1_Y_DistFromBall_AtSnap = max(Safety1_Y_DistFromBall_AtSnap),
            Safety1_Y_AbsDistFromBall_AtSnap = max(Safety1_Y_AbsDistFromBall_AtSnap),
            Safety1_Y_DistFromMOF_AtSnap = max(Safety1_Y_DistFromMOF_AtSnap),
            Safety1_Y_AbsDistFromMOF_AtSnap = max(Safety1_Y_AbsDistFromMOF_AtSnap),
            Safety1_Tot_DistFromBall_AtSnap = max(Safety1_Tot_DistFromBall_AtSnap),
            Safety1_Speed_AtSnap = max(Safety1_Speed_AtSnap), Safety1_Acceleration_AtSnap = max(Safety1_Acceleration_AtSnap),
            Safety1_x_vel_component_AtSnap = max(Safety1_x_vel_component_AtSnap),
            Safety1_y_vel_component_AtSnap = max(Safety1_y_vel_component_AtSnap),
            Safety1_x_acc_component_AtSnap = max(Safety1_x_acc_component_AtSnap),
            Safety1_y_acc_component_AtSnap = max(Safety1_y_acc_component_AtSnap),
            Safety1_Orientation_AtSnap = max(Safety1_Orientation_AtSnap), Safety1_Direction_AtSnap = max(Safety1_Direction_AtSnap),
            Safety1_X_3SecBeforeSnap = max(Safety1_X_3SecBeforeSnap), Safety1_Y_3SecBeforeSnap = max(Safety1_Y_3SecBeforeSnap), 
            Safety1_VertCreptDistance = max(Safety1_VertCreptDistance), Safety1_TotalCreptDistance_TowardBall = max(Safety1_TotalCreptDistance_TowardBall),
            Safety1_PosGroup = max(Safety1_PosGroup), Safety1_position = max(Safety1_position),
            x_spline_basis1_p1 = max(x_spline_basis1_p1), x_spline_basis2_p1 = max(x_spline_basis2_p1), 
            x_spline_basis3_p1 = max(x_spline_basis3_p1), x_spline_basis4_p1 = max(x_spline_basis4_p1),
            x_spline_basis5_p1 = max(x_spline_basis5_p1), x_spline_basis6_p1 = max(x_spline_basis6_p1),                       
            x_spline_basis7_p1 = max(x_spline_basis7_p1), x_spline_basis8_p1 = max(x_spline_basis8_p1),                     
            x_spline_basis9_p1 = max(x_spline_basis9_p1), x_spline_basis10_p1 = max(x_spline_basis10_p1),                   
            y_spline_basis1_p1 = max(y_spline_basis1_p1), y_spline_basis2_p1 = max(y_spline_basis2_p1),          
            y_spline_basis3_p1 = max(y_spline_basis3_p1), y_spline_basis4_p1 = max(y_spline_basis4_p1),                  
            y_spline_basis5_p1 = max(y_spline_basis5_p1), y_spline_basis6_p1 = max(y_spline_basis6_p1),                 
            y_spline_basis7_p1 = max(y_spline_basis7_p1), y_spline_basis8_p1 = max(y_spline_basis8_p1),                  
            y_spline_basis9_p1 = max(y_spline_basis9_p1), y_spline_basis10_p1 = max(y_spline_basis10_p1),                  
            Safety2_Initial_X = Safety2_Initial_X[1], Safety2_Initial_Y = Safety2_Initial_Y[1], 
            Safety2_Max_PreSnap_PreSnapSpeed = max(Safety2_Max_PreSnapSpeed), Safety2_Avg_PreSnapSpeed = mean(Safety2_Avg_PreSnapSpeed),
            Safety2_Max_PreSnapAcceleration = max(Safety2_Max_PreSnapAcceleration), 
            Safety2_Avg_PreSnapAcceleration = mean(Safety2_Avg_PreSnapAcceleration),
            Safety2_Max_PreSnap_x_vel_component = max(Safety2_Max_PreSnap_x_vel_component), 
            Safety2_Max_PreSnap_y_vel_component = max(Safety2_Max_PreSnap_y_vel_component), 
            Safety2_Max_PreSnap_x_acc_component = max(Safety2_Max_PreSnap_x_acc_component), 
            Safety2_Max_PreSnap_y_acc_component = max(Safety2_Max_PreSnap_y_acc_component),
            Safety2_Mean_PreSnap_x_vel_component = mean(Safety2_Mean_PreSnap_x_vel_component), 
            Safety2_Mean_PreSnap_y_vel_component = mean(Safety2_Mean_PreSnap_y_vel_component), 
            Safety2_Mean_PreSnap_x_acc_component = mean(Safety2_Mean_PreSnap_x_acc_component), 
            Safety2_Mean_PreSnap_y_acc_component = mean(Safety2_Mean_PreSnap_y_acc_component), 
            Safety2_Tot_PreSnapDistance = sum(Safety2_Tot_PreSnapDistance), Safety2_InitialOrientation = Safety2_InitialOrientation[1],
            Safety2_InitialDirection = Safety2_InitialDirection[1], Safety2_Initial_X_DistFromBall = Safety2_Initial_X_DistFromBall[1],
            Safety2_Initial_Y_DistFromBall = Safety2_Initial_Y_DistFromBall[1], Safety2_Initial_Tot_DistFromBall = Safety2_Initial_Tot_DistFromBall[1],
            Safety2_Initial_Y_DistFromMOF = Safety2_Initial_Y_DistFromMOF[1], Safety2_Initial_Y_AbsDistFromMOF = Safety2_Initial_Y_AbsDistFromMOF[1],
            Safety2_Max_PreSnap_X_DistFromBall = max(Safety2_Max_PreSnap_X_DistFromBall),
            Safety2_Max_PreSnap_Y_AbsDistFromBall = max(Safety2_Max_PreSnap_Y_AbsDistFromBall), 
            Safety2_Max_PreSnap_Tot_DistFromBall = max(Safety2_Max_PreSnap_Tot_DistFromBall),
            Safety2_X_DistFromBall_AtSnap = max(Safety2_X_DistFromBall_AtSnap),
            Safety2_Y_DistFromBall_AtSnap = max(Safety2_Y_DistFromBall_AtSnap),
            Safety2_Y_AbsDistFromBall_AtSnap = max(Safety2_Y_AbsDistFromBall_AtSnap),
            Safety2_Y_DistFromMOF_AtSnap = max(Safety2_Y_DistFromMOF_AtSnap),
            Safety2_Y_AbsDistFromMOF_AtSnap = max(Safety2_Y_AbsDistFromMOF_AtSnap),
            Safety2_Tot_DistFromBall_AtSnap = max(Safety2_Tot_DistFromBall_AtSnap),
            Safety2_Speed_AtSnap = max(Safety2_Speed_AtSnap), Safety2_Acceleration_AtSnap = max(Safety2_Acceleration_AtSnap),
            Safety2_x_vel_component_AtSnap = max(Safety2_x_vel_component_AtSnap),
            Safety2_y_vel_component_AtSnap = max(Safety2_y_vel_component_AtSnap),
            Safety2_x_acc_component_AtSnap = max(Safety2_x_acc_component_AtSnap),
            Safety2_y_acc_component_AtSnap = max(Safety2_y_acc_component_AtSnap),
            Safety2_Orientation_AtSnap = max(Safety2_Orientation_AtSnap), Safety2_Direction_AtSnap = max(Safety2_Direction_AtSnap),
            Safety2_X_3SecBeforeSnap = max(Safety2_X_3SecBeforeSnap), Safety2_Y_3SecBeforeSnap = max(Safety2_Y_3SecBeforeSnap), 
            Safety2_VertCreptDistance = max(Safety2_VertCreptDistance), Safety2_TotalCreptDistance_TowardBall = max(Safety2_TotalCreptDistance_TowardBall),
            Safety2_PosGroup = max(Safety2_PosGroup), Safety2_position = max(Safety2_position),
            x_spline_basis1_p2 = max(x_spline_basis1_p2), x_spline_basis2_p2 = max(x_spline_basis2_p2), 
            x_spline_basis3_p2 = max(x_spline_basis3_p2), x_spline_basis4_p2 = max(x_spline_basis4_p2),
            x_spline_basis5_p2 = max(x_spline_basis5_p2), x_spline_basis6_p2 = max(x_spline_basis6_p2),                       
            x_spline_basis7_p2 = max(x_spline_basis7_p2), x_spline_basis8_p2 = max(x_spline_basis8_p2),                     
            x_spline_basis9_p2 = max(x_spline_basis9_p2), x_spline_basis10_p2 = max(x_spline_basis10_p2),                   
            y_spline_basis1_p2 = max(y_spline_basis1_p2), y_spline_basis2_p2 = max(y_spline_basis2_p2),          
            y_spline_basis3_p2 = max(y_spline_basis3_p2), y_spline_basis4_p2 = max(y_spline_basis4_p2),                  
            y_spline_basis5_p2 = max(y_spline_basis5_p2), y_spline_basis6_p2 = max(y_spline_basis6_p2),                 
            y_spline_basis7_p2 = max(y_spline_basis7_p2), y_spline_basis8_p2 = max(y_spline_basis8_p2),                  
            y_spline_basis9_p2 = max(y_spline_basis9_p2), y_spline_basis10_p2 = max(y_spline_basis10_p2))

# If we need to export to CSV
write.csv(final_dropbacks_merged, "final_dropbacks_merged.csv")
write.csv(Stats_ByPlayerAndPlay_Final, "Stats_ByPlayerAndPlay_Final.csv")
write.csv(Stats_ByFullPlay_Final, "Stats_ByFullPlay_Final.csv")
